import sys
import time
import subprocess
from pathlib import Path

import webview

HOST = "127.0.0.1"
PORT = 8000
URL = f"http://{HOST}:{PORT}"

def main():
    project_dir = Path(__file__).resolve().parent
    python = sys.executable

    # Lance le serveur FastAPI (uvicorn) en arrière-plan
    subprocess.Popen(
        [python, "-m", "uvicorn", "server:app", "--host", HOST, "--port", str(PORT)],
        cwd=str(project_dir),
        stdout=subprocess.DEVNULL,
        stderr=subprocess.DEVNULL
    )

    # Laisse le serveur démarrer
    time.sleep(2.0)

    # Ouvre une fenêtre desktop (sans navigateur)
    webview.create_window("SNG WEB BOT", URL, width=1100, height=700)
    webview.start()

if __name__ == "__main__":
    main()
